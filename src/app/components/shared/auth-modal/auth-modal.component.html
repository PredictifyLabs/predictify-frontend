@if (isVisible) {
  <div class="auth-modal-overlay" (click)="onOverlayClick($event)">
    <div class="auth-modal">
      <button class="close-btn" (click)="closeModal()">
        <i nz-icon nzType="close" nzTheme="outline"></i>
      </button>

      <!-- Options View -->
      @if (mode === 'options') {
        <div class="modal-content options-view">
          <div class="modal-icon">
            <i nz-icon nzType="lock" nzTheme="outline"></i>
          </div>
          <h2>Inicia sesión para continuar</h2>
          <p class="message">{{ message }}</p>
          
          <div class="options-buttons">
            <button class="btn-primary" (click)="goToLogin()">
              <i nz-icon nzType="login" nzTheme="outline"></i>
              Iniciar sesión
            </button>
            <button class="btn-secondary" (click)="goToRegister()">
              <i nz-icon nzType="user-add" nzTheme="outline"></i>
              Crear cuenta
            </button>
          </div>

          <p class="alt-link">
            ¿Prefieres ver más opciones? 
            <a (click)="navigateToAuth()">Ir a la página de login</a>
          </p>
        </div>
      }

      <!-- Login View -->
      @if (mode === 'login') {
        <div class="modal-content login-view">
          <button class="back-btn" (click)="goBack()">
            <i nz-icon nzType="arrow-left" nzTheme="outline"></i>
          </button>
          
          <h2>Iniciar sesión</h2>
          <p class="subtitle">Ingresa tus credenciales para continuar</p>

          @if (error) {
            <div class="error-message">
              <i nz-icon nzType="warning" nzTheme="outline"></i>
              {{ error }}
            </div>
          }

          <form (ngSubmit)="submitLogin()">
            <div class="form-group">
              <label for="email">Correo electrónico</label>
              <input 
                type="email" 
                id="email" 
                [(ngModel)]="loginEmail" 
                name="email"
                placeholder="tu@correo.com"
                [disabled]="loading"
              />
            </div>

            <div class="form-group">
              <label for="password">Contraseña</label>
              <input 
                type="password" 
                id="password" 
                [(ngModel)]="loginPassword" 
                name="password"
                placeholder="••••••••"
                [disabled]="loading"
              />
            </div>

            <button type="submit" class="btn-primary btn-full" [disabled]="loading">
              @if (loading) {
                <i nz-icon nzType="loading" nzTheme="outline"></i>
                Ingresando...
              } @else {
                Ingresar
              }
            </button>
          </form>

          <p class="alt-link">
            ¿No tienes cuenta? <a (click)="goToRegister()">Regístrate</a>
          </p>
        </div>
      }

      <!-- Register View -->
      @if (mode === 'register') {
        <div class="modal-content register-view">
          <button class="back-btn" (click)="goBack()">
            <i nz-icon nzType="arrow-left" nzTheme="outline"></i>
          </button>
          
          <h2>Crear cuenta</h2>
          <p class="subtitle">Regístrate para inscribirte en eventos</p>

          @if (error) {
            <div class="error-message">
              <i nz-icon nzType="warning" nzTheme="outline"></i>
              {{ error }}
            </div>
          }

          <form (ngSubmit)="submitRegister()">
            <div class="form-group">
              <label for="name">Nombre completo</label>
              <input 
                type="text" 
                id="name" 
                [(ngModel)]="registerName" 
                name="name"
                placeholder="Tu nombre"
                [disabled]="loading"
              />
            </div>

            <div class="form-group">
              <label for="regEmail">Correo electrónico</label>
              <input 
                type="email" 
                id="regEmail" 
                [(ngModel)]="registerEmail" 
                name="regEmail"
                placeholder="tu@correo.com"
                [disabled]="loading"
              />
            </div>

            <div class="form-group">
              <label for="regPassword">Contraseña</label>
              <input 
                type="password" 
                id="regPassword" 
                [(ngModel)]="registerPassword" 
                name="regPassword"
                placeholder="Mínimo 8 caracteres"
                [disabled]="loading"
              />
            </div>

            <button type="submit" class="btn-primary btn-full" [disabled]="loading">
              @if (loading) {
                <i nz-icon nzType="loading" nzTheme="outline"></i>
                Creando cuenta...
              } @else {
                Crear cuenta
              }
            </button>
          </form>

          <p class="alt-link">
            ¿Ya tienes cuenta? <a (click)="goToLogin()">Inicia sesión</a>
          </p>
        </div>
      }
    </div>
  </div>
}
