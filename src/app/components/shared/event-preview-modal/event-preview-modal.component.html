@if (isVisible && event) {
  <div class="modal-backdrop" (click)="onBackdropClick($event)">
    <div class="modal-container" [style.--event-color]="eventColor">
      
      <!-- Header Actions -->
      <div class="modal-header">
        <div class="header-actions">
          <button class="copy-btn" (click)="copyLink()">
            <span nz-icon nzType="link" nzTheme="outline"></span>
            Copiar enlace
          </button>
          <button class="page-btn" (click)="goToEvent()">
            Página del evento
          </button>
        </div>
        <div class="nav-actions">
          <button class="nav-btn">
            <span nz-icon nzType="up" nzTheme="outline"></span>
          </button>
          <button class="nav-btn">
            <span nz-icon nzType="down" nzTheme="outline"></span>
          </button>
          <button class="nav-btn" (click)="closeModal()">
            <span nz-icon nzType="close" nzTheme="outline"></span>
          </button>
        </div>
      </div>

      <!-- Scrollable Content -->
      <div class="modal-scroll">
        <!-- Event Image -->
        <div class="event-image-container">
          <img 
            [src]="event.imageUrl || 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=800'"
            [alt]="event.title"
            class="event-image"
          />
          <div class="image-date-badge">
            {{ event.startDate | date:'d' }} DE {{ event.startDate | date:'MMMM' | uppercase }}
          </div>
        </div>

        <!-- Event Content -->
        <div class="event-content">
          <!-- Badge -->
          <div class="event-badge">
            <span nz-icon nzType="star" nzTheme="fill"></span>
            Destacado en {{ event.location?.city || 'Tu ciudad' }}
          </div>

          <!-- Title -->
          <h2 class="event-title">{{ event.title }}</h2>

          <!-- Organizer -->
          <div class="organizer-row">
            <div class="organizer-avatars">
              <img 
                [src]="event.organizer.avatar || 'https://api.dicebear.com/7.x/initials/svg?seed=' + event.organizer.displayName"
                [alt]="event.organizer.displayName"
                class="organizer-avatar"
              />
            </div>
            <span class="organizer-text">
              Organizado por <strong>{{ event.organizer.displayName }}</strong>
            </span>
          </div>

          <!-- Date -->
          <div class="info-row">
            <div class="info-icon">
              <span nz-icon nzType="calendar" nzTheme="outline"></span>
            </div>
            <div class="info-text">
              <span class="info-primary">{{ formattedDate }}</span>
              <span class="info-secondary">{{ formattedTime }}</span>
            </div>
          </div>

          <!-- Location -->
          <div class="info-row">
            <div class="info-icon">
              <span nz-icon nzType="environment" nzTheme="outline"></span>
            </div>
            <div class="info-text">
              <span class="info-primary">{{ event.location?.venue || 'Ubicación por confirmar' }}</span>
              <span class="info-secondary">{{ event.location?.city }}, {{ event.location?.country }}</span>
            </div>
          </div>

          <!-- Registration Section -->
          <div class="section-card">
            <h3 class="section-title">Inscripción</h3>
            <div class="approval-notice">
              <span nz-icon nzType="check-circle" nzTheme="outline"></span>
              <div>
                <span class="notice-title">Aprobación requerida</span>
                <span class="notice-desc">Tu inscripción está sujeta a la aprobación del anfitrión.</span>
              </div>
            </div>
            <div class="attention-box">
              <span nz-icon nzType="info-circle" nzTheme="outline"></span>
              <span>¡Atención! Para unirte al evento, por favor regístrate o confírmalo.</span>
            </div>
            <button class="join-btn" (click)="registerToEvent()">
              Solicitar unirse
            </button>
          </div>

          <!-- Location Map Section -->
          <div class="section-card">
            <h3 class="section-title">Ubicación</h3>
            <div class="location-details">
              <strong>{{ event.location?.venue || 'Por confirmar' }}</strong>
              <span>{{ event.location?.address || '' }}</span>
              <span>{{ event.location?.city }}, {{ event.location?.country }}</span>
            </div>
            <div class="map-container">
              <iframe
                [src]="getMapUrl()"
                width="100%"
                height="150"
                style="border:0; border-radius: 8px;"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade">
              </iframe>
            </div>
          </div>

          <!-- Organized By Section -->
          <div class="section-card">
            <h3 class="section-title">Organizado por</h3>
            <div class="organizers-list">
              <div class="organizer-item">
                <img 
                  [src]="event.organizer.avatar || 'https://api.dicebear.com/7.x/initials/svg?seed=' + event.organizer.displayName"
                  [alt]="event.organizer.displayName"
                  class="organizer-avatar-lg"
                />
                <span>{{ event.organizer.displayName }}</span>
              </div>
            </div>
          </div>

          <!-- Attendees Section -->
          <div class="section-card">
            <h3 class="section-title">{{ event.registeredCount || 0 }} asistentes</h3>
            <div class="attendees-avatars">
              @for (i of [1,2,3,4,5]; track i) {
                <div class="attendee-avatar placeholder">
                  <span nz-icon nzType="user" nzTheme="outline"></span>
                </div>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button class="footer-link">
          <span nz-icon nzType="message" nzTheme="outline"></span>
          Contactar al anfitrión
        </button>
        <button class="footer-link danger">
          <span nz-icon nzType="flag" nzTheme="outline"></span>
          Denunciar evento
        </button>
      </div>
    </div>
  </div>
}

<!-- Auth Modal -->
<app-auth-modal
  [isVisible]="showAuthModal()"
  [message]="'Para inscribirte en este evento necesitas iniciar sesión o crear una cuenta'"
  (close)="closeAuthModal()"
  (authenticated)="onAuthenticated()">
</app-auth-modal>
