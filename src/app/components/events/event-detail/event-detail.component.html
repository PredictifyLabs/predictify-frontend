<div class="event-detail-page" *ngIf="!isLoading && event">
  
  <!-- Hero Section -->
  <div class="event-hero" [style.background-image]="'linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.8)), url(' + event.image + ')'">
    <div class="hero-content">
      <!-- Breadcrumbs -->
      <div class="breadcrumbs">
        <span class="breadcrumb-item" (click)="goBack()">
          <span nz-icon nzType="arrow-left" nzTheme="outline"></span> Eventos
        </span>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">{{ event.title }}</span>
      </div>

      <!-- Tags -->
      <div class="event-tags">
        <span class="tag category">{{ event.category }}</span>
        <span class="tag type">{{ event.location.type }}</span>
        <span class="tag trending" *ngIf="event.isTrending"> Trending</span>
      </div>

      <!-- Title -->
      <h1 class="event-title">{{ event.title }}</h1>

      <!-- Organizer -->
      <div class="organizer-info">
        <img [src]="event.organizer.avatar" [alt]="event.organizer.name" class="organizer-avatar">
        <div class="organizer-details">
          <span class="organizer-name">
            {{ event.organizer.name }}
            <span nz-icon nzType="safety-certificate" nzTheme="fill" class="verified-icon" *ngIf="event.organizer.isVerified"></span>
          </span>
          <span class="organizer-meta">{{ event.organizer.eventsCount }} eventos organizados</span>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="hero-actions">
        <button class="action-btn" (click)="share()">
          <span nz-icon nzType="share-alt" nzTheme="outline"></span>
          Compartir
        </button>
        <button class="action-btn" [class.saved]="isSaved" (click)="toggleSave()">
          <span nz-icon [nzType]="isSaved ? 'heart' : 'heart'" [nzTheme]="isSaved ? 'fill' : 'outline'"></span>
          {{ isSaved ? 'Guardado' : 'Guardar' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="event-content">
    <div class="content-grid">
      
      <!-- Left Column (70%) -->
      <div class="left-column">
        
        <!-- Prediction Panel -->
        <div class="prediction-panel card-glass">
          <div class="panel-header">
            <h2> Predicci贸n IA de Asistencia</h2>
          </div>
          
          <div class="prediction-content">
            <div class="prediction-visual">
              <app-prediction-meter
                *ngIf="event.prediction"
                [probability]="event.prediction.probability"
                [variant]="'circular'"
                [size]="'lg'"
                [showLabel]="true"
                [animated]="true"
              ></app-prediction-meter>
            </div>

            <div class="prediction-info" *ngIf="event.prediction">
              <div class="prediction-level" [class]="event.prediction.level">
                <span class="level-icon">
                  {{ event.prediction.level === 'high' ? '' : event.prediction.level === 'medium' ? '' : '' }}
                </span>
                <span class="level-text">
                  {{ event.prediction.level === 'high' ? 'Alta probabilidad de asistencia' : 
                     event.prediction.level === 'medium' ? 'Probabilidad media de asistencia' : 
                     'Baja probabilidad de asistencia' }}
                </span>
              </div>

              <div class="estimation">
                <h4>Estimaci贸n de asistentes:</h4>
                <p class="estimation-range">
                  {{ event.prediction.estimatedAttendees.min }}-{{ event.prediction.estimatedAttendees.max }} personas
                  <span class="expected">(~{{ event.prediction.estimatedAttendees.expected }} esperados)</span>
                </p>
                <p class="capacity-info">de {{ event.capacity }} capacidad total</p>
              </div>

              <app-prediction-factors
                [factors]="event.prediction.factors"
                [maxFactors]="5"
              ></app-prediction-factors>

              <button class="btn-secondary full-width">
                Ver An谩lisis Completo
              </button>
            </div>
          </div>
        </div>

        <!-- Description -->
        <div class="description-section card-glass">
          <h3> Descripci贸n del Evento</h3>
          <p class="description-text">{{ event.description }}</p>
        </div>

        <!-- Agenda (if available) -->
        <div class="agenda-section card-glass" *ngIf="event.agenda && event.agenda.length > 0">
          <h3> Agenda</h3>
          <div class="agenda-timeline">
            <div class="agenda-item" *ngFor="let item of event.agenda">
              <div class="agenda-time">{{ item.time }}</div>
              <div class="agenda-content">
                <h4>{{ item.title }}</h4>
                <p *ngIf="item.description">{{ item.description }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Speakers (if available) -->
        <div class="speakers-section card-glass" *ngIf="event.speakers && event.speakers.length > 0">
          <h3> Ponentes</h3>
          <div class="speakers-grid">
            <div class="speaker-card" *ngFor="let speaker of event.speakers">
              <img [src]="speaker.avatar" [alt]="speaker.name" class="speaker-avatar">
              <h4>{{ speaker.name }}</h4>
              <p class="speaker-title">{{ speaker.title }}</p>
              <p class="speaker-company">{{ speaker.company }}</p>
            </div>
          </div>
        </div>

        <!-- Location -->
        <div class="location-section card-glass">
          <h3> Ubicaci贸n</h3>
          <div class="location-info">
            <p class="location-type">
              <span nz-icon [nzType]="event.location.type === 'virtual' ? 'global' : 'environment'" nzTheme="outline"></span>
              {{ event.location.type === 'virtual' ? 'Evento Virtual' : 'Evento Presencial' }}
            </p>
            <p class="location-address" *ngIf="event.location.address">
              {{ event.location.address }}, {{ event.location.city }}, {{ event.location.country }}
            </p>
            <p class="location-venue" *ngIf="event.location.venue">
              {{ event.location.venue }}
            </p>
          </div>
        </div>

      </div>

      <!-- Right Column (30%) - Sticky -->
      <div class="right-column">
        <div class="sticky-sidebar">
          
          <!-- Event Info Card -->
          <div class="info-card card-glass">
            <div class="info-item">
              <span nz-icon nzType="calendar" nzTheme="outline"></span>
              <div class="info-text">
                <span class="info-label">Fecha</span>
                <span class="info-value">{{ formatDate(event.date) }}</span>
              </div>
            </div>

            <div class="info-item">
              <span nz-icon nzType="clock-circle" nzTheme="outline"></span>
              <div class="info-text">
                <span class="info-label">Hora</span>
                <span class="info-value">{{ event.time }}</span>
              </div>
            </div>

            <div class="info-item">
              <span nz-icon nzType="environment" nzTheme="outline"></span>
              <div class="info-text">
                <span class="info-label">Ubicaci贸n</span>
                <span class="info-value">{{ event.location.city || 'Virtual' }}</span>
              </div>
            </div>

            <div class="info-item">
              <span nz-icon nzType="dollar" nzTheme="outline"></span>
              <div class="info-text">
                <span class="info-label">Precio</span>
                <span class="info-value">{{ event.isFree ? 'Gratis' : '$' + event.price }}</span>
              </div>
            </div>

            <div class="divider"></div>

            <div class="capacity-info-box">
              <div class="capacity-item">
                <span class="capacity-number">{{ event.interested }}</span>
                <span class="capacity-label">Interesados</span>
              </div>
              <div class="capacity-item">
                <span class="capacity-number">{{ event.capacity }}</span>
                <span class="capacity-label">Capacidad</span>
              </div>
            </div>

            <button class="btn-primary full-width" (click)="register()">
              Registrarse Ahora
            </button>

            <div class="divider"></div>

            <!-- Prediction Summary -->
            <div class="prediction-summary" *ngIf="event.prediction">
              <div class="summary-header">
                <span>Probabilidad</span>
                <span class="probability-value" [style.color]="event.prediction.level === 'high' ? '#10B981' : event.prediction.level === 'medium' ? '#F59E0B' : '#EF4444'">
                  {{ event.prediction.probability }}%
                </span>
              </div>
              <app-prediction-meter
                [probability]="event.prediction.probability"
                [variant]="'compact'"
                [size]="'sm'"
                [showLabel]="false"
              ></app-prediction-meter>
              <p class="estimation-text">
                Estimaci贸n: ~{{ event.prediction.estimatedAttendees.expected }} asistentes reales
              </p>
            </div>

            <div class="divider"></div>

            <!-- Share -->
            <div class="share-section">
              <span class="share-label">Compartir:</span>
              <div class="share-buttons">
                <button class="share-btn"></button>
                <button class="share-btn"></button>
                <button class="share-btn"></button>
                <button class="share-btn"></button>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>

</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="isLoading">
  <div class="spinner"></div>
  <p>Cargando evento...</p>
</div>
